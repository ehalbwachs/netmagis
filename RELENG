How to release a Netmagis version?

2012/03/06	pda, jean

This document describes step by step the Netmagis release engineering process.

TODO:
    - update demo application


Git branches and tags
---------------------

Starting from v2.1.0, Netmagis use a new version numbering scheme:
- X.Y.0 releases are function-oriented
- X.Y.Z releases are maintenance releases

Taking the v2.1.0 release as an example:
- v2.1.0 release is the first of the 2.1 branch
- when bug fixes appear, new versions are added to the 2.1 branch:
    v2.1.1, v2.1.2, etc.

To do so, the git repository have branches and tags
- X.Y are branches in the git repository
- each release have a matching tag vX.Y.Z : v2.1.0, v2.1.1, etc.

So, during development of the future 2.3 branch, the repository
vill looks like:

    ---------------------------------------->	master : current dev
	\         \
	 \         `v2.2.0--*--*--*--v2.2.1-->	2.2 branch : bug fix
	  \
	   `v2.1.0--*--*--*--*--v2.1.1--*-->	2.1 branch : obsolete


How to release, step by step
----------------------------

1. On the development server

    1.a. You should already be in the development branch

	git checkout X.Y

    1.b. Be sure to get the files updated

	cd $NETMAGIS
	git pull

    1.c. Update the CHANGES file to reflect changes made by the
	release, and don't forget to update the release date

    1.d. Update version number

	cd $NETMAGIS
	vi Makefile				# Modify the VERSION variable

    1.e. Check everything is ok before releasing

	./devtools/utils/mkrel -n X.Y.Z

    1.f. If everything is ok, tag the release

	./devtools/utils/mkrel X.Y.Z

    1.g. Copy the tar.gz file to the distribution server

	scp netmagis*.tar.gz www:/www/docs/files/

2. On the web server

    2.a. Be sure to get the files updated

	cd $NETMAGIS
	git pull

    2.b. Update the doc/netmagis/relnotes.htgt to reflect changes
	made by the release, and don't forget to update the release date

    2.c. Update version number [XXX TODO]

	cd $NETMAGIS
	vi pkg/freebsd/netmagis-common/Makefile	# Modify the PORTVERSION var

    2.d. Update installation documentation and web site 

	umask 002
	cd $NETMAGIS/doc/netmagis.org
	cp install-$OLDVERSION.htgt install-$VERSION.htgt
	# update installation documentation
	vi install-$VERSION.htgt
	# update links to new version (install, download etc.)
	vi index.* news.* doc.* download.*
	cd $NETMAGIS
	make \
	    DESTDIR=/www/docs \
	    TCLSH=/usr/local/bin/tclsh8.5 \
	    TCLCONF=/usr/share/tcltk/tcl8.5/tclConfig.sh \
	    install-netmagis.org

    2.e. Update screenshots

	cd $NETMAGIS/doc/netmagis.org
	# create new screenshots (1024x768) as shot-*.png
	for i in shot-*.png ; do cp $i `echo $i | sed 's/shot-/vign-/'` ; done
	mogrify -resize 256x192 vign-*.png

    2.f. Commit changes

	git commit -a

3. On the FreeBSD host

    3.a. Be sure to get the files updated

	cd $NETMAGIS
	git pull --all
	git checkout X.Y
    
    3.b. Generate ports

	cd $NETMAGIS
    	make freebsd-ports

    3.c. Copy ports to the web server

    	scp netmagis-freebsd-ports-*.tar.gz netmagis.org:/www/docs/files/

4. On the Debian/Ubuntu host

    4.a. Be sure to get the files updated

	cd $NETMAGIS
	git pull --all
	git checkout X.Y
    
    4.b. Generate debian packages

	cd $NETMAGIS
    	make debian-packages
    	sudo make debian-packages-other-arch

    4.c. Create repository if needed
    	
	mkdir -p /local/repo/conf
	# add the following lines in /local/repo/conf/distributions
	    Origin: netmagis
	    Label: netmagis
	    Codename: stable
	    Architectures: amd64 i386 source
	    Components: main
	    Description: Apt repository for netmagis

	    Origin: netmagis
	    Label: netmagis
	    Codename: dev
	    Architectures: amd64 i386 source
	    Components: main
	    Description: Dev apt repository for netmagis

    4.d. Update local repository

	make DEBIAN_DISTRIB=stable debian-repo
	# use DEBIAN_DISTRIB=dev to update the dev distribution

    4.e. Copy local repository to the web server

	tar cf - -C /local repo | \
		ssh netmagis.org tar xf - -C /www/docs/files

5. Announce the release

    5.a Post to the netmagis mailing-list

	If this is a major version, post to some other carefully
	choosen lists

    5.b Update Wikipedia pages

	http://en.wikipedia.org/wiki/Internet_Protocol_Address_Management

    5.c Close all remaining issues for this milestone

	https://github.com/pdav/netmagis/issues

6. Prepare new version vX.Z

    6.a Change git branch

	git checkout master

    6.b Create a github milestone for the new version

	If needed, create a milestone vX.Z on
	https://github.com/pdav/netmagis/issues/milestones

    6.b Open release engineering issues for the new version

	create issues labelled :
	    CHANGES and release notes
	    Installation documentation for vX.Z
	and associate them to the newly created milestone
